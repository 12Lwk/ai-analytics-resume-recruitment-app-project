{% extends 'resume_app/base.html' %}
{% load static %}

{% block title %}Resume Upload - AI Recruitment System{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/resume_upload.css' %}">
{% endblock %}

{% block content %}
<div class="resume-upload-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-text">
                <h1 class="page-title">
                    <i class="bi bi-cloud-upload-fill"></i>
                    Resume Upload
                </h1>
                <p class="page-subtitle">Upload candidate resumes and let AI extract key information automatically</p>
            </div>
            <div class="header-stats">
                <div class="stat-card">
                    <div class="stat-number">{{ total_uploads }}</div>
                    <div class="stat-label">Total Uploads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ processing_count }}</div>
                    <div class="stat-label">Processing</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-number">{{ success_rate }}%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Display -->
    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <i class="bi bi-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-triangle{% elif message.tags == 'warning' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="upload-layout">
        <!-- Upload Section -->
        <div class="upload-section">
            <div class="upload-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="bi bi-upload"></i>
                        Upload Resumes
                    </h3>
                    <p class="card-subtitle">Drag and drop files or click to browse</p>
                </div>

                <form method="post" enctype="multipart/form-data" id="upload-form">
                    {% csrf_token %}

                    <!-- File Upload Area -->
                    <div class="upload-area" id="upload-area">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <i class="bi bi-cloud-upload"></i>
                            </div>
                            <h4>Drop your resume files here</h4>
                            <p>or <span class="browse-link">click to browse</span></p>
                            <div class="file-info">
                                <small>Supported formats: PDF, DOC, DOCX, TXT</small>
                                <small>Maximum file size: 5MB per file</small>
                            </div>
                        </div>
                        <input type="file" name="resume_files" id="file-input" multiple
                               accept=".pdf,.doc,.docx,.txt" style="display: none;">
                    </div>

                    <!-- Selected Files Display -->
                    <div class="selected-files" id="selected-files" style="display: none;">
                        <h5>Selected Files:</h5>
                        <div class="files-list" id="files-list"></div>
                    </div>

                    <!-- Job Information -->
                    <div class="job-info-section">
                        <h5>Job Information (Optional)</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Job Title</label>
                                <input type="text" name="job_title" class="form-input"
                                       placeholder="e.g., Senior Software Engineer">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select name="department" class="form-input">
                                    <option value="">Select Department</option>
                                    <option value="engineering">Engineering</option>
                                    <option value="product">Product</option>
                                    <option value="design">Design</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="sales">Sales</option>
                                    <option value="hr">Human Resources</option>
                                    <option value="finance">Finance</option>
                                    <option value="operations">Operations</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tags</label>
                            <input type="text" name="tags" class="form-input"
                                   placeholder="e.g., senior, remote, urgent (comma-separated)">
                        </div>
                    </div>

                    <!-- Upload Button -->
                    <div class="upload-actions">
                        <button type="button" class="btn btn-secondary" onclick="clearFiles()">
                            <i class="bi bi-x-circle"></i>
                            Clear Files
                        </button>
                        <button type="submit" class="btn btn-primary" id="upload-btn" disabled>
                            <i class="bi bi-upload"></i>
                            Upload & Process
                        </button>
                    </div>
                </form>
            </div>

            <!-- AI Features Info -->
            <div class="ai-features-card">
                <div class="card-header">
                    <h4 class="card-title">
                        <i class="bi bi-robot"></i>
                        AI-Powered Features
                    </h4>
                </div>
                <div class="features-list">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="bi bi-search"></i>
                        </div>
                        <div class="feature-text">
                            <h6>Smart Data Extraction</h6>
                            <p>Automatically extracts contact info, experience, skills, and education</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="bi bi-shield-check"></i>
                        </div>
                        <div class="feature-text">
                            <h6>Duplicate Detection</h6>
                            <p>Identifies and merges duplicate candidate profiles intelligently</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="bi bi-star"></i>
                        </div>
                        <div class="feature-text">
                            <h6>Quality Scoring</h6>
                            <p>AI-driven assessment of resume completeness and quality</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="bi bi-tags"></i>
                        </div>
                        <div class="feature-text">
                            <h6>Auto Tagging</h6>
                            <p>Automatically categorizes candidates by skills and experience level</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Uploads Section -->
        <div class="recent-uploads-section">
            <div class="recent-uploads-card">
                <div class="card-header">
                    <h4 class="card-title">
                        <i class="bi bi-clock-history"></i>
                        Recent Uploads
                    </h4>
                </div>
                <div class="uploads-list">
                    {% if recent_uploads %}
                        {% for upload in recent_uploads %}
                            <div class="upload-item">
                                <div class="upload-info">
                                    <div class="upload-icon-small">
                                        <i class="bi bi-file-earmark-text"></i>
                                    </div>
                                    <div class="upload-details">
                                        <h6>{{ upload.filename }}</h6>
                                        <p>{{ upload.upload_date|date:"M d, Y H:i" }}</p>
                                        {% if upload.job_title %}
                                            <span class="job-tag">{{ upload.job_title }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="upload-status">
                                    {% if upload.status == 'completed' %}
                                        <span class="status-badge success">
                                            <i class="bi bi-check-circle"></i> Completed
                                        </span>
                                    {% elif upload.status == 'processing' %}
                                        <span class="status-badge processing">
                                            <i class="bi bi-arrow-clockwise"></i> Processing
                                        </span>
                                    {% else %}
                                        <span class="status-badge failed">
                                            <i class="bi bi-x-circle"></i> Failed
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <p>No recent uploads</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Processing Tips -->
            <div class="tips-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="bi bi-lightbulb"></i>
                        Upload Tips
                    </h5>
                </div>
                <div class="tips-list">
                    <div class="tip-item">
                        <i class="bi bi-check2"></i>
                        <span>Use clear, well-formatted resumes for best AI extraction results</span>
                    </div>
                    <div class="tip-item">
                        <i class="bi bi-check2"></i>
                        <span>PDF format typically provides the most accurate parsing</span>
                    </div>
                    <div class="tip-item">
                        <i class="bi bi-check2"></i>
                        <span>Include job title and department for better candidate organization</span>
                    </div>
                    <div class="tip-item">
                        <i class="bi bi-check2"></i>
                        <span>Use tags to create custom candidate categories</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Processing Modal -->
<div class="modal fade" id="processingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="processing-animation">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <h5 class="mt-3">Processing Resumes</h5>
                <p>AI is extracting candidate information...</p>
                <div class="progress mt-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         role="progressbar" style="width: 0%" id="progress-bar"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/resume_upload.js' %}"></script>
{% endblock %}